function RSPD=getRSPD(illuCode)
%
% 获得光源的相对光谱功率分布数据
% 输入参数：光源代码，如 a、c、d50、d65、f4等
% 输出参数：光源的相对光谱功率分布，n×2,第一列是波长，第二列是数据
%
% wangtengfeng@whu.edu.cn

illuCode=lower(illuCode);

if isempty(findstr(illuCode,'f')) % 如果光源代码中不包含f字母，在说明不是F系列光源
    switch illuCode
       case {'A' ,'a'}
           RSPD=SPD_A;
       case {'C' ,'c'}
           RSPD=SPD_CIE_C;
       case {'D50','50','d50',50}
           RSPD = RSPD_Dxx(5000);
       case {'D55','55','d55',55}
           RSPD=RSPD_Dxx(5500);
       case {'D65','65','d65',65}
           RSPD=RSPD_Dxx(6500);
       case {'D75','75','d75',75}
           RSPD=RSPD_Dxx(7500);
       otherwise  % 不存在的光源，或代码没写对
           RSPD=0;
           msgbox('没有此光源!','出错','error');
           return
    end
else % 否则就是F系列光源
   [a,len]=size(illuCode);
   illuCode=illuCode(2:len);
   illuCode=str2num(illuCode);
    if isempty(illuCode)
       RSPD=0;
       msgbox('没有此光源!','出错','error');
       return
    end
   data=SPD_Fser;
   RSPD=[data(:,1),data(:,illuCode+1)];
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

function S=RSPD_A()
% 照明体A的相对光谱功率分布，
% 按照CIE 15的方法计算

jg=5; %波长间隔
wave=300:jg:830; % 波长范围

tempdata1=1.435*10^7/2848;
S=100*(560./wave).^5*(exp(tempdata1/560)-1)./(exp(tempdata1./wave)-1);

 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

function S=RSPD_Dxx(cct)
% 照明体Dxx的相对光谱功率分布，
% 按照CIE 15的方法计算
% 输入参数ct 是相关色温，在4000K～25000K
%
%
%

jg=5; %波长间隔
wave=300:jg:830; % 波长范围
if cct>=4000 && cct<=7000
   Xd=-4.6070*10^9/cct^3+2.9678*10^6/cct^2+99.11/cct+0.244063;
else if cct>7000 && cct<25000
       Xd=-2.0064*10^9/cct^3+1.9018*10^6/cct^2+247.48/cct+0.23704;
    else
       ERROR();
       return;
    end
end

Yd=-3*Xd^2+2.87*Xd-0.275;
M1=(-1.3515-1.7703*Xd+5.9114*Yd)/(0.0241+0.2562*Xd-0.7341*Yd);
M2=(0.03 -31.4424*Xd+30.0717*Yd)/(0.0241+0.2562*Xd-0.7341*Yd);

S012=[300 0.04 0.02 0.00
305 3.02 2.26 1.00
310 6.00 4.50 2.00
315 17.80 13.45 3.00
320 29.60 22.40 4.00
325 42.45 32.20 6.25
330 55.30 42.00 8.50
335 56.30 41.30 8.15
340 57.30 40.60 7.80
345 59.55 41.10 7.25
350 61.80 41.60 6.70
355 61.65 39.80 6.00
360 61.50 38.00 5.30
365 65.15 40.20 5.70
370 68.80 42.40 6.10
375 66.10 40.45 4.55
380 63.40 38.50 3.00
385 64.60 36.75 2.10
390 65.80 35.00 1.20
395 80.30 39.20 0.05
400 94.80 43.40 -1.10
405 99.80 44.85 -0.80
410 104.80 46.30 -0.50
415 105.35 45.10 -0.60
420 105.90 43.90 -0.70
425 101.35 40.50 -0.95
430 96.80 37.10 -1.20
435 105.35 36.90 -1.90
440 113.90 36.70 -2.60
445 119.75 36.30 -2.75
450 125.60 35.90 -2.90
455 125.55 34.25 -2.85
460 125.50 32.60 -2.80
465 123.40 30.25 -2.70
470 121.30 27.90 -2.60
475 121.30 26.10 -2.60
480 121.30 24.30 -2.60
485 117.40 22.20 -2.20
490 113.50 20.10 -1.80
495 113.30 18.15 -1.65
500 113.10 16.20 -1.50
505 111.95 14.70 -1.40
510 110.80 13.20 -1.30
515 108.65 10.90 -1.25
520 106.50 8.60 -1.20
525 107.65 7.35 -1.10
530 108.80 6.10 -1.00
535 107.05 5.15 -0.75
540 105.30 4.20 -0.50
545 104.85 3.05 -0.40
550 104.40 1.90 -0.30
555 102.20 0.95 -0.15
560 100.00 0.00 0.00
565 98.00 -0.80 0.10
570 96.00 -1.60 0.20
575 95.55 -2.55 0.35
580 95.10 -3.50 0.50
585 92.10 -3.50 1.30
590 89.10 -3.50 2.10
595 89.80 -4.65 2.65
600 90.50 -5.80 3.20
605 90.40 -6.50 3.65
610 90.30 -7.20 4.10
615 89.35 -7.90 4.40
620 88.40 -8.60 4.70
625 86.20 -9.05 4.90
630 84.00 -9.50 5.10
635 84.55 -10.20 5.90
640 85.10 -10.90 6.70
645 83.50 -10.80 7.00
650 81.90 -10.70 7.30
655 82.25 -11.35 7.95
660 82.60 -12.00 8.60
665 83.75 -13.00 9.20
670 84.90 -14.00 9.80
675 83.10 -13.80 10.00
680 81.30 -13.60 10.20
685 76.60 -12.80 9.25
690 71.90 -12.00 8.30
695 73.10 -12.65 8.95
700 74.30 -13.30 9.60
705 75.35 -13.10 9.05
710 76.40 -12.90 8.50
715 69.85 -11.75 7.75
720 63.30 -10.60 7.00
725 67.50 -11.10 7.30
730 71.70 -11.60 7.60
735 74.35 -11.90 7.80
740 77.00 -12.20 8.00
745 71.10 -11.20 7.35
750 65.20 -10.20 6.70
755 56.45 -9.00 5.95
760 47.70 -7.80 5.20
765 58.15 -9.50 6.30
770 68.60 -11.20 7.40
775 66.80 -10.80 7.10
780 65.00 -10.40 6.80
785 65.50 -10.50 6.90
790 66.00 -10.60 7.00
795 63.50 -10.15 6.70
800 61.00 -9.70 6.40
805 57.15 -9.00 5.95
810 53.30 -8.30 5.50
815 56.10 -8.80 5.80
820 58.90 -9.30 6.10
825 60.40 -9.55 6.30
830 61.90 -9.80 6.50]

S=S012(:,2)+M1*S012(:,3)+M2*S012(:,4);

 S=[(300:jg:830)',S];

 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%U

function data=SPD_CIE_C()
% C光源的光谱相对能量分布

data=[320 0.01
325 0.20
330 0.40
335 1.55
340 2.70
345 4.85
350 7.00
355 9.95
360 12.90
365 17.20
370 21.40
375 27.50
380 33.00
385 39.92
390 47.40
395 55.17
400 63.30
405 71.81
410 80.60
415 89.53
420 98.10
425 105.80
430 112.40
435 117.75
440 121.50
445 123.45
450 124.00
455 123.60
460 123.10
465 123.30
470 123.80
475 124.09
480 123.90
485 122.92
490 120.70
495 116.90
500 112.10
505 106.98
510 102.30
515 98.81
520 96.90
525 96.78
530 98.00
535 99.94
540 102.10
545 103.95
550 105.20
555 105.67
560 105.30
565 104.11
570 102.30
575 100.15
580 97.80
585 95.43
590 93.20
595 91.22
600 89.70
605 88.83
610 88.40
615 88.19
620 88.10
625 88.06
630 88.00
635 87.86
640 87.80
645 87.99
650 88.20
655 88.20
660 87.90
665 87.22
670 86.30
675 85.30
680 84.00
685 82.21
690 80.20
695 78.24
700 76.30
705 74.36
710 72.40
715 70.40
720 68.30
725 66.30
730 64.40
735 62.80
740 61.50
745 60.20
750 59.20
755 58.50
760 58.10
765 58.00
770 58.20
775 58.50
780 59.10];